<!doctype html>
<html>
<head>
<meta charset="utf-8" />
<title>Tarea 15 Stickman</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.js"></script>
</head>

<body>
<script>

let xS, yS, dS, rS, vS;
let xL, yL, dL, rL, vL;
let dia, mes, anio;

// Stickman
let xP, yP, S, vP;
let groundY, vY, jumpV, g;
let rHead, bodyL, armL, legL;
let hipY, shoulderY, headY;

// Disparo
let xD, yD, tD, vD;
let disparoActivo;

// Objetivo
let xO, yO, wO, hO, vO;

function setup() {
  createCanvas(800, 800);

  dS = min(width, height) * 0.2;
  rS = dS / 2;
  xS = -rS;
  yS = height * 0.25;
  vS = width / 400;

  dL = dS * 0.5;
  rL = dL / 2;
  xL = -width - rL;
  yL = height * 0.3;
  vL = vS;

  dia = 1;
  mes = 1;
  anio = 2025;

  groundY = height * 0.8;

  S = 0.12 * min(width, height);
  xP = width * 0.25;
  yP = groundY;
  vP = width / 150;

  vY = 0;
  jumpV = -0.03 * height;
  g = 0.0016 * height;

  rHead = 0.2 * S;
  bodyL = 0.6 * S;
  armL = 0.45 * S;
  legL = 0.55 * S;

  disparoActivo = false;
  tD = width / 80;
  vD = height / 50;

  wO = width * 0.08;
  hO = height * 0.05;
  yO = random(height * 0.2, height * 0.35);
  xO = -wO;
  vO = random(2, 4);
}

function draw() {

  if (xS <= width + rS) background(135, 206, 235);
  else background(0);

  noStroke();
  fill(20, 120, 40);
  rect(0, groundY, width, height - groundY);

  fill(245, 234, 10);
  circle(xS, yS, dS);
  fill(200);
  circle(xL, yL, dL);

  xS += vS;
  xL += vL;

  xO += vO;

  if (xO > width + wO) {
    xO = -wO;
    vO = random(2, 4);
  }

  if (xO < -wO) {
    xO = width + wO;
    vO = -random(2, 4);
  }

  dibujarObjetivo();


  // DISPARO
  if (disparoActivo) {
    yD = yD - vD;

    if (yD < 0) {
      disparoActivo = false;
    }

    dibujarDisparo();
  }

  actualizarCalendario();
  dibujarStickman();
  dibujarCalendario();
}

function dibujarObjetivo() {
  fill(255, 0, 0);
  rect(xO, yO, wO, hO);
}

function dibujarDisparo() {
  fill(255);
  rect(xD - tD / 4, yD - tD, tD / 2, tD);
}

function dibujarStickman() {
  if (keyIsDown(LEFT_ARROW)) xP -= vP;
  if (keyIsDown(RIGHT_ARROW)) xP += vP;
 if (xP < 0) {
  xP = 0;
} else if (xP > width) {
  xP = width;
}

  vY += g;
  yP += vY;
  if (yP > groundY) {
    yP = groundY;
    vY = 0;
  }

  hipY = yP - legL;
  shoulderY = hipY - bodyL;
  headY = shoulderY - rHead;

  stroke(255);
  strokeWeight(0.06 * S);
  noFill();

  circle(xP, headY, 2 * rHead);
  line(xP, shoulderY, xP, hipY);
  line(xP - 0.25 * S, shoulderY, xP + 0.25 * S, shoulderY);
  line(xP - 0.25 * S, shoulderY, xP - 0.25 * S, shoulderY + armL);
  line(xP + 0.25 * S, shoulderY, xP + 0.25 * S, shoulderY + armL);
  line(xP, hipY, xP - 0.18 * S, yP);
  line(xP, hipY, xP + 0.18 * S, yP);
}

function dibujarCalendario() {
  fill(255);
 stroke (0);
  textSize(20);
  text("Fecha: " + dia + "/" + mes + "/" + anio, 10, 25);
}

function keyPressed() {

  if (keyCode == UP_ARROW) {
    if (yP == groundY) {
      vY = jumpV;
    }
  }

 if (keyCode == 32) {
  if (!disparoActivo) {
    xD = xP;
    yD = shoulderY;
    disparoActivo = true;
  }
}

}

function actualizarCalendario() {
  if (xS >= 2 * width - rS) {
    xS = -rS;
    xL = -width - rL;
    dia= dia+1;
  }

  if (dia > 30) {
    dia = 1;
    mes=mes+1;
  }

  if (mes > 12) {
    mes = 1;
    anio=anio+1;
  }
}
</script>
</body>
</html>

